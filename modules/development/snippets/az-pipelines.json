{
  "Azure Pipeline - Starter": {
    "prefix": "az-pipeline-starter",
    "body": [
      "---",
      "trigger:",
      "  branches:",
      "    include:",
      "      - main",
      "      - develop",
      "      - release/*",
      "  paths:",
      "    exclude:",
      "      - README.md",
      "      - '**/*.md'",
      "",
      "pr:",
      "  branches:",
      "    include:",
      "      - main",
      "      - develop",
      "      - feature/*",
      "      - bugfix/*",
      "      - hotfix/*",
      "",
      "pool:",
      "  vmImage: ubuntu-latest",
      "",
      "variables:",
      "  - name: buildConfiguration",
      "    value: Release",
      "  - name: buildPlatform",
      "    value: anycpu",
      "  - group: GlobalVariables",
      "",
      "stages:",
      "  - stage: Build",
      "    displayName: Build Stage",
      "    jobs:",
      "      - job: Build",
      "        displayName: Build Application",
      "        steps:",
      "          - task: UseDotNet@2",
      "            displayName: Use .NET SDK",
      "            inputs:",
      "              version: 8.x",
      "",
      "          - task: DotNetCoreCLI@2",
      "            displayName: Restore NuGet packages",
      "            inputs:",
      "              command: restore",
      "              projects: '**/*.csproj'",
      "",
      "          - task: DotNetCoreCLI@2",
      "            displayName: Build solution",
      "            inputs:",
      "              command: build",
      "              projects: '**/*.csproj'",
      "              arguments: --configuration $(buildConfiguration) --no-restore",
      "",
      "          - task: DotNetCoreCLI@2",
      "            displayName: Run tests",
      "            inputs:",
      "              command: test",
      "              projects: '**/*Tests.csproj'",
      "              arguments: --configuration $(buildConfiguration) --no-build --verbosity normal",
      "",
      "          - task: DotNetCoreCLI@2",
      "            displayName: Publish application",
      "            inputs:",
      "              command: publish",
      "              publishWebProjects: true",
      "              arguments: --configuration $(buildConfiguration) --output $(Build.ArtifactStagingDirectory) --no-build",
      "",
      "          - task: PublishBuildArtifacts@1",
      "            displayName: Publish artifacts",
      "            inputs:",
      "              PathtoPublish: $(Build.ArtifactStagingDirectory)",
      "              ArtifactName: drop",
      "",
      "  - stage: DeployToDev",
      "    displayName: Deploy to Development",
      "    dependsOn: Build",
      "    condition: succeeded()",
      "    jobs:",
      "      - deployment: DeployDev",
      "        displayName: Deploy to Development",
      "        environment: Development",
      "        strategy:",
      "          runOnce:",
      "            deploy:",
      "              steps:",
      "                - download: current",
      "                  artifact: drop",
      "",
      "                - task: AzureWebApp@1",
      "                  displayName: Deploy to Azure Web App",
      "                  inputs:",
      "                    azureSubscription: $(azureServiceConnection)",
      "                    appName: $(webAppNameDev)",
      "                    package: $(Pipeline.Workspace)/drop/**/*.zip",
      "",
      "  - stage: DeployToProd",
      "    displayName: Deploy to Production",
      "    dependsOn: DeployToDev",
      "    condition: and(succeeded(), eq(variables['Build.SourceBranch'], 'refs/heads/main'))",
      "    jobs:",
      "      - deployment: DeployProd",
      "        displayName: Deploy to Production",
      "        environment: Production",
      "        strategy:",
      "          runOnce:",
      "            deploy:",
      "              steps:",
      "                - download: current",
      "                  artifact: drop",
      "",
      "                - task: AzureWebApp@1",
      "                  displayName: Deploy to Azure Web App",
      "                  inputs:",
      "                    azureSubscription: $(azureServiceConnection)",
      "                    appName: $(webAppNameProd)",
      "                    package: $(Pipeline.Workspace)/drop/**/*.zip"
    ],
    "description": "Complete Azure DevOps YAML Pipeline with Build, Test, and Deploy stages"
  },
  "Docker Build and Push": {
    "prefix": "az-docker-pipeline",
    "body": [
      "---",
      "trigger:",
      "  branches:",
      "    include:",
      "      - main",
      "      - develop",
      "",
      "variables:",
      "  - name: imageRepository",
      "    value: myapp",
      "  - name: dockerfilePath",
      "    value: '**/Dockerfile'",
      "  - name: tag",
      "    value: $(Build.BuildId)",
      "",
      "pool:",
      "  vmImage: ubuntu-latest",
      "",
      "stages:",
      "  - stage: BuildAndPush",
      "    displayName: Build and Push Docker Image",
      "    jobs:",
      "      - job: Build",
      "        displayName: Build Docker Image",
      "        steps:",
      "          - task: Docker@2",
      "            displayName: Login to ACR",
      "            inputs:",
      "              command: login",
      "              containerRegistry: $(acrServiceConnection)",
      "",
      "          - task: Docker@2",
      "            displayName: Build and Push",
      "            inputs:",
      "              command: buildAndPush",
      "              repository: $(imageRepository)",
      "              dockerfile: $(dockerfilePath)",
      "              containerRegistry: $(acrServiceConnection)",
      "              tags: |",
      "                $(tag)",
      "                latest",
      "",
      "          - task: Docker@2",
      "            displayName: Logout from ACR",
      "            inputs:",
      "              command: logout",
      "              containerRegistry: $(acrServiceConnection)"
    ],
    "description": "Docker build and push pipeline for Azure Container Registry"
  },
  "Kubernetes Deployment Pipeline": {
    "prefix": "az-k8s-pipeline",
    "body": [
      "---",
      "trigger:",
      "  branches:",
      "    include:",
      "      - main",
      "",
      "variables:",
      "  - name: namespace",
      "    value: default",
      "  - name: manifestPath",
      "    value: manifests/",
      "  - name: imageTag",
      "    value: $(Build.BuildId)",
      "",
      "pool:",
      "  vmImage: ubuntu-latest",
      "",
      "stages:",
      "  - stage: DeployToAKS",
      "    displayName: Deploy to AKS",
      "    jobs:",
      "      - deployment: DeployAKS",
      "        displayName: Deploy to AKS",
      "        environment: aks-$(namespace)",
      "        strategy:",
      "          runOnce:",
      "            deploy:",
      "              steps:",
      "                - task: KubernetesManifest@0",
      "                  displayName: Create imagePullSecret",
      "                  inputs:",
      "                    action: createSecret",
      "                    namespace: $(namespace)",
      "                    secretType: dockerRegistry",
      "                    secretName: acr-secret",
      "                    dockerRegistryEndpoint: $(acrServiceConnection)",
      "",
      "                - task: KubernetesManifest@0",
      "                  displayName: Deploy to AKS",
      "                  inputs:",
      "                    action: deploy",
      "                    namespace: $(namespace)",
      "                    manifests: |",
      "                      $(manifestPath)/deployment.yaml",
      "                      $(manifestPath)/service.yaml",
      "                      $(manifestPath)/ingress.yaml",
      "                    imagePullSecrets: acr-secret",
      "                    containers: $(acrRegistry)/$(imageRepository):$(imageTag)",
      "",
      "                - task: Kubernetes@1",
      "                  displayName: Check deployment status",
      "                  inputs:",
      "                    connectionType: Kubernetes Service Connection",
      "                    kubernetesServiceEndpoint: $(aksServiceConnection)",
      "                    namespace: $(namespace)",
      "                    command: rollout",
      "                    arguments: status deployment/$(deploymentName)"
    ],
    "description": "AKS deployment pipeline with Kubernetes manifests"
  },
  "Multi-Container App Pipeline": {
    "prefix": "az-multi-container",
    "body": [
      "---",
      "trigger:",
      "  branches:",
      "    include:",
      "      - main",
      "",
      "variables:",
      "  - name: dockerComposeFile",
      "    value: '**/docker-compose.yml'",
      "  - name: tag",
      "    value: $(Build.BuildId)",
      "",
      "pool:",
      "  vmImage: ubuntu-latest",
      "",
      "stages:",
      "  - stage: BuildAndPushContainers",
      "    displayName: Build and Push Containers",
      "    jobs:",
      "      - job: BuildPushFrontend",
      "        displayName: Build and Push Frontend",
      "        steps:",
      "          - task: Docker@2",
      "            displayName: Build Frontend",
      "            inputs:",
      "              command: buildAndPush",
      "              repository: $(frontendImageName)",
      "              dockerfile: $(frontendDockerfilePath)",
      "              containerRegistry: $(acrServiceConnection)",
      "              tags: $(tag)",
      "",
      "      - job: BuildPushBackend",
      "        displayName: Build and Push Backend",
      "        steps:",
      "          - task: Docker@2",
      "            displayName: Build Backend",
      "            inputs:",
      "              command: buildAndPush",
      "              repository: $(backendImageName)",
      "              dockerfile: $(backendDockerfilePath)",
      "              containerRegistry: $(acrServiceConnection)",
      "              tags: $(tag)",
      "",
      "  - stage: DeployWithCompose",
      "    displayName: Deploy with Docker Compose",
      "    dependsOn: BuildAndPushContainers",
      "    jobs:",
      "      - deployment: DeployCompose",
      "        displayName: Docker Compose Deploy",
      "        environment: docker-compose",
      "        strategy:",
      "          runOnce:",
      "            deploy:",
      "              steps:",
      "                - task: DockerCompose@0",
      "                  displayName: Run Docker Compose",
      "                  inputs:",
      "                    containerregistrytype: Azure Container Registry",
      "                    azureSubscription: $(azureServiceConnection)",
      "                    azureContainerRegistry: $(acrRegistry)",
      "                    dockerComposeFile: $(dockerComposeFile)",
      "                    action: Run a Docker Compose command",
      "                    additionalDockerComposeFiles: docker-compose.override.yml",
      "                    dockerComposeCommand: up -d"
    ],
    "description": "Multi-container application pipeline with Docker Compose"
  },
  "Azure Functions Pipeline": {
    "prefix": "az-functions-pipeline",
    "body": [
      "---",
      "trigger:",
      "  branches:",
      "    include:",
      "      - main",
      "",
      "variables:",
      "  - name: functionAppName",
      "    value: myfunctionapp",
      "  - name: functionAppPath",
      "    value: $(System.DefaultWorkingDirectory)/MyFunctionApp",
      "",
      "pool:",
      "  vmImage: ubuntu-latest",
      "",
      "stages:",
      "  - stage: BuildAndDeployFunctions",
      "    displayName: Build and Deploy Azure Functions",
      "    jobs:",
      "      - job: BuildFunctions",
      "        displayName: Build Functions",
      "        steps:",
      "          - task: UseDotNet@2",
      "            displayName: Use .NET SDK",
      "            inputs:",
      "              version: 8.x",
      "",
      "          - task: DotNetCoreCLI@2",
      "            displayName: Restore packages",
      "            inputs:",
      "              command: restore",
      "              projects: '**/*.csproj'",
      "",
      "          - task: DotNetCoreCLI@2",
      "            displayName: Build functions",
      "            inputs:",
      "              command: build",
      "              projects: '**/*.csproj'",
      "              arguments: --configuration Release --output $(Build.ArtifactStagingDirectory)",
      "",
      "          - task: ArchiveFiles@2",
      "            displayName: Archive function app",
      "            inputs:",
      "              rootFolderOrFile: $(Build.ArtifactStagingDirectory)",
      "              includeRootFolder: false",
      "              archiveType: zip",
      "              archiveFile: $(Build.ArtifactStagingDirectory)/functionapp.zip",
      "",
      "          - task: PublishBuildArtifacts@1",
      "            displayName: Publish function app artifact",
      "            inputs:",
      "              PathtoPublish: $(Build.ArtifactStagingDirectory)/functionapp.zip",
      "              ArtifactName: functionapp",
      "",
      "      - deployment: DeployFunctions",
      "        displayName: Deploy Functions",
      "        dependsOn: BuildFunctions",
      "        environment: functions",
      "        strategy:",
      "          runOnce:",
      "            deploy:",
      "              steps:",
      "                - download: current",
      "                  artifact: functionapp",
      "",
      "                - task: AzureFunctionApp@1",
      "                  displayName: Deploy to Azure Functions",
      "                  inputs:",
      "                    azureSubscription: $(azureServiceConnection)",
      "                    appType: functionApp",
      "                    appName: $(functionAppName)",
      "                    package: $(Pipeline.Workspace)/functionapp/functionapp.zip",
      "                    deploymentMethod: zipDeploy"
    ],
    "description": "Azure Functions CI/CD pipeline"
  },
  "Security Scanning Pipeline": {
    "prefix": "az-security-pipeline",
    "body": [
      "---",
      "trigger: none",
      "",
      "pr:",
      "  branches:",
      "    include:",
      "      - '*'",
      "",
      "pool:",
      "  vmImage: ubuntu-latest",
      "",
      "variables:",
      "  - name: skipComponentGovernanceDetection",
      "    value: false",
      "",
      "stages:",
      "  - stage: SecurityScan",
      "    displayName: Security Scanning",
      "    jobs:",
      "      - job: SecurityChecks",
      "        displayName: Run Security Checks",
      "        steps:",
      "          - task: ComponentGovernanceComponentDetection@0",
      "            displayName: Component Detection",
      "            condition: eq(variables.skipComponentGovernanceDetection, false)",
      "",
      "          - task: CredScan@3",
      "            displayName: Credential Scanner",
      "            inputs:",
      "              toolMajorVersion: V2",
      "              scanFolder: $(Build.SourcesDirectory)",
      "              debugMode: false",
      "",
      "          - task: PoliCheck@2",
      "            displayName: PoliCheck Scan",
      "            inputs:",
      "              inputType: Basic",
      "              targetType: F",
      "              targetArgument: $(Build.SourcesDirectory)",
      "",
      "          - task: PostAnalysis@2",
      "            displayName: Post Security Analysis",
      "            inputs:",
      "              GdnBreakAllTools: false",
      "              GdnBreakGdnToolCredScan: true",
      "              GdnBreakGdnToolPoliCheck: true"
    ],
    "description": "Security scanning pipeline with various Azure security tools"
  },
  "Container Scan and Deploy": {
    "prefix": "az-container-scan",
    "body": [
      "---",
      "trigger:",
      "  branches:",
      "    include:",
      "      - main",
      "",
      "variables:",
      "  - name: imageName",
      "    value: myapp",
      "  - name: imageTag",
      "    value: $(Build.BuildId)",
      "  - name: acrName",
      "    value: myacr.azurecr.io",
      "",
      "pool:",
      "  vmImage: ubuntu-latest",
      "",
      "stages:",
      "  - stage: BuildAndScan",
      "    displayName: Build and Security Scan",
      "    jobs:",
      "      - job: BuildScanContainer",
      "        displayName: Build and Scan Container",
      "        steps:",
      "          - task: Docker@2",
      "            displayName: Build Docker image",
      "            inputs:",
      "              command: build",
      "              repository: $(imageName)",
      "              dockerfile: '**/Dockerfile'",
      "              tags: $(imageTag)",
      "",
      "          - task: Docker@2",
      "            displayName: Push to ACR",
      "            condition: and(succeeded(), eq(variables['Build.SourceBranch'], 'refs/heads/main'))",
      "            inputs:",
      "              command: push",
      "              repository: $(imageName)",
      "              containerRegistry: $(acrServiceConnection)",
      "              tags: $(imageTag)",
      "",
      "  - stage: DeployScannedImage",
      "    displayName: Deploy Scanned Image",
      "    dependsOn: BuildAndScan",
      "    condition: and(succeeded(), eq(variables['Build.SourceBranch'], 'refs/heads/main'))",
      "    jobs:",
      "      - deployment: DeployToAKS",
      "        displayName: Deploy to AKS",
      "        environment: production",
      "        strategy:",
      "          runOnce:",
      "            deploy:",
      "              steps:",
      "                - task: KubernetesManifest@0",
      "                  displayName: Deploy secured image",
      "                  inputs:",
      "                    action: deploy",
      "                    namespace: default",
      "                    manifests: deployment.yaml",
      "                    containers: $(acrName)/$(imageName):$(imageTag)"
    ],
    "description": "Container security scanning pipeline with vulnerability checks"
  },
  "Infrastructure as Code Pipeline": {
    "prefix": "az-bicep-pipeline",
    "body": [
      "---",
      "trigger:",
      "  branches:",
      "    include:",
      "      - main",
      "  paths:",
      "    include:",
      "      - infra/**",
      "      - .pipelines/infra-pipeline.yml",
      "",
      "pool:",
      "  vmImage: ubuntu-latest",
      "",
      "variables:",
      "  - name: environment",
      "    value: dev",
      "  - name: location",
      "    value: eastus2",
      "",
      "stages:",
      "  - stage: ValidateBicep",
      "    displayName: Validate Bicep Templates",
      "    jobs:",
      "      - job: Validate",
      "        displayName: Validate Infrastructure",
      "        steps:",
      "          - task: AzureCLI@2",
      "            displayName: Validate Bicep files",
      "            inputs:",
      "              azureSubscription: $(azureServiceConnection)",
      "              scriptType: bash",
      "              scriptLocation: inlineScript",
      "              inlineScript: |",
      "                az bicep build --file infra/main.bicep",
      "                az deployment sub validate --location $(location) --template-file infra/main.bicep --parameters infra/params/$(environment).parameters.json",
      "",
      "  - stage: DeployInfrastructure",
      "    displayName: Deploy Infrastructure",
      "    dependsOn: ValidateBicep",
      "    jobs:",
      "      - deployment: DeployResources",
      "        displayName: Deploy Azure Resources",
      "        environment: $(environment)",
      "        strategy:",
      "          runOnce:",
      "            deploy:",
      "              steps:",
      "                - task: AzureResourceManagerTemplateDeployment@3",
      "                  displayName: Deploy Bicep Template",
      "                  inputs:",
      "                    deploymentScope: Resource Group",
      "                    azureResourceManagerConnection: $(azureServiceConnection)",
      "                    subscriptionId: $(subscriptionId)",
      "                    action: Create Or Update Resource Group",
      "                    resourceGroupName: rg-$(environment)-$(resourceSuffix)",
      "                    location: $(location)",
      "                    templateLocation: Linked artifact",
      "                    csmFile: infra/main.bicep",
      "                    csmParametersFile: infra/params/$(environment).parameters.json",
      "                    deploymentMode: Incremental",
      "",
      "  - stage: ConfigureResources",
      "    displayName: Post-Deployment Configuration",
      "    dependsOn: DeployInfrastructure",
      "    jobs:",
      "      - job: Configuration",
      "        displayName: Configure Deployed Resources",
      "        steps:",
      "          - task: AzureCLI@2",
      "            displayName: Run post-deployment scripts",
      "            inputs:",
      "              azureSubscription: $(azureServiceConnection)",
      "              scriptType: bash",
      "              scriptLocation: inlineScript",
      "              inlineScript: |",
      "                echo 'Infrastructure deployment completed successfully'"
    ],
    "description": "Infrastructure as Code pipeline using Bicep/ARM templates"
  },
  "Multi-Stage Approval Pipeline": {
    "prefix": "az-approval-pipeline",
    "body": [
      "---",
      "trigger:",
      "  branches:",
      "    include:",
      "      - main",
      "",
      "pool:",
      "  vmImage: ubuntu-latest",
      "",
      "stages:",
      "  - stage: Build",
      "    displayName: Build Stage",
      "    jobs:",
      "      - job: BuildJob",
      "        displayName: Build Application",
      "        steps:",
      "          - script: echo 'Building application...'",
      "            displayName: Build step",
      "",
      "  - stage: DeployToDev",
      "    displayName: Deploy to Development",
      "    dependsOn: Build",
      "    jobs:",
      "      - deployment: DeployDev",
      "        displayName: Deploy to Development",
      "        environment: Development",
      "        strategy:",
      "          runOnce:",
      "            deploy:",
      "              steps:",
      "                - script: echo 'Deploying to development...'",
      "                  displayName: Deploy step",
      "",
      "  - stage: DeployToQA",
      "    displayName: Deploy to QA",
      "    dependsOn: DeployToDev",
      "    jobs:",
      "      - deployment: DeployQA",
      "        displayName: Deploy to QA",
      "        environment: QA",
      "        strategy:",
      "          runOnce:",
      "            deploy:",
      "              steps:",
      "                - script: echo 'Deploying to QA...'",
      "                  displayName: Deploy step",
      "",
      "  - stage: DeployToProd",
      "    displayName: Deploy to Production",
      "    dependsOn: DeployToQA",
      "    jobs:",
      "      - deployment: DeployProd",
      "        displayName: Deploy to Production",
      "        environment: Production",
      "        strategy:",
      "          runOnce:",
      "            deploy:",
      "              steps:",
      "                - script: echo 'Deploying to production...'",
      "                  displayName: Deploy step"
    ],
    "description": "Pipeline with manual approval gates between environments"
  },
  "Testing Pipeline with Reports": {
    "prefix": "az-testing-pipeline",
    "body": [
      "---",
      "trigger:",
      "  branches:",
      "    include:",
      "      - main",
      "      - develop",
      "",
      "pool:",
      "  vmImage: windows-latest",
      "",
      "variables:",
      "  - name: testResultsFolder",
      "    value: $(System.DefaultWorkingDirectory)/TestResults",
      "  - name: codeCoverageFolder",
      "    value: $(System.DefaultWorkingDirectory)/CodeCoverage",
      "",
      "stages:",
      "  - stage: Test",
      "    displayName: Testing Stage",
      "    jobs:",
      "      - job: RunTests",
      "        displayName: Execute Tests",
      "        steps:",
      "          - task: VSTest@2",
      "            displayName: Run Unit Tests",
      "            inputs:",
      "              testSelector: testAssemblies",
      "              testAssemblyVer2: |",
      "                **/*Tests*.dll",
      "                !**/obj/**",
      "              searchFolder: $(System.DefaultWorkingDirectory)",
      "              codeCoverageEnabled: true",
      "              testRunTitle: Unit Test Run $(Build.BuildId)",
      "",
      "          - task: PublishTestResults@2",
      "            displayName: Publish Test Results",
      "            inputs:",
      "              testRunner: VSTest",
      "              testResultsFiles: '**/*.trx'",
      "              searchFolder: $(testResultsFolder)",
      "              testRunTitle: Test Results $(Build.BuildId)",
      "",
      "          - task: PublishCodeCoverageResults@2",
      "            displayName: Publish Code Coverage",
      "            inputs:",
      "              summaryFileLocation: $(codeCoverageFolder)/**/coverage.cobertura.xml",
      "",
      "          - task: SonarCloudPrepare@2",
      "            displayName: Prepare SonarCloud Analysis",
      "            inputs:",
      "              SonarCloud: SonarCloud",
      "              organization: $(sonarCloudOrganization)",
      "              scannerMode: MSBuild",
      "              projectKey: $(sonarCloudProjectKey)",
      "              projectName: $(projectName)",
      "",
      "          - task: SonarCloudAnalyze@2",
      "            displayName: Run SonarCloud Analysis",
      "",
      "          - task: SonarCloudPublish@2",
      "            displayName: Publish SonarCloud Results"
    ],
    "description": "Comprehensive testing pipeline with reports and code coverage"
  },
  "Terraform Azure Pipeline": {
    "prefix": "az-terraform-pipeline",
    "body": [
      "---",
      "trigger:",
      "  branches:",
      "    include:",
      "      - main",
      "  paths:",
      "    include:",
      "      - terraform/**",
      "",
      "pool:",
      "  vmImage: ubuntu-latest",
      "",
      "variables:",
      "  - name: terraformVersion",
      "    value: 1.6.0",
      "  - name: environment",
      "    value: dev",
      "",
      "stages:",
      "  - stage: TerraformInit",
      "    displayName: Terraform Init",
      "    jobs:",
      "      - job: InitTerraform",
      "        displayName: Initialize Terraform",
      "        steps:",
      "          - task: TerraformInstaller@1",
      "            displayName: Install Terraform",
      "            inputs:",
      "              terraformVersion: $(terraformVersion)",
      "",
      "          - task: TerraformTaskV4@4",
      "            displayName: Terraform Init",
      "            inputs:",
      "              provider: azurerm",
      "              command: init",
      "              workingDirectory: terraform/$(environment)",
      "              backendServiceArm: $(azureServiceConnection)",
      "              backendAzureRmResourceGroupName: $(terraformBackendRG)",
      "              backendAzureRmStorageAccountName: $(terraformBackendStorage)",
      "              backendAzureRmContainerName: tfstate",
      "              backendAzureRmKey: $(environment).tfstate",
      "",
      "  - stage: TerraformPlan",
      "    displayName: Terraform Plan",
      "    dependsOn: TerraformInit",
      "    jobs:",
      "      - job: GeneratePlan",
      "        displayName: Generate Terraform Plan",
      "        steps:",
      "          - task: TerraformTaskV4@4",
      "            displayName: Terraform Plan",
      "            inputs:",
      "              provider: azurerm",
      "              command: plan",
      "              workingDirectory: terraform/$(environment)",
      "              environmentServiceNameAzureRM: $(azureServiceConnection)",
      "              commandOptions: -var-file=$(environment).tfvars -out=tfplan",
      "",
      "          - task: PublishBuildArtifacts@1",
      "            displayName: Publish Terraform Plan",
      "            inputs:",
      "              PathtoPublish: terraform/$(environment)/tfplan",
      "              ArtifactName: tfplan-$(environment)",
      "",
      "  - stage: TerraformApply",
      "    displayName: Terraform Apply",
      "    dependsOn: TerraformPlan",
      "    condition: and(succeeded(), eq(variables['Build.SourceBranch'], 'refs/heads/main'))",
      "    jobs:",
      "      - job: ApplyTerraform",
      "        displayName: Apply Terraform Changes",
      "        steps:",
      "          - download: current",
      "            artifact: tfplan-$(environment)",
      "",
      "          - task: TerraformTaskV4@4",
      "            displayName: Terraform Apply",
      "            inputs:",
      "              provider: azurerm",
      "              command: apply",
      "              workingDirectory: terraform/$(environment)",
      "              environmentServiceNameAzureRM: $(azureServiceConnection)",
      "              commandOptions: tfplan"
    ],
    "description": "Terraform infrastructure pipeline with plan/apply stages"
  },
  "WebApp Testing Pipeline": {
    "prefix": "az-webapp-testing",
    "body": [
      "---",
      "# Web Application Testing Pipeline",
      "# Includes unit tests, integration tests, E2E tests, and performance tests",
      "",
      "trigger:",
      "  branches:",
      "    include:",
      "      - main",
      "      - develop",
      "  paths:",
      "    exclude:",
      "      - README.md",
      "      - docs/**",
      "",
      "pr:",
      "  branches:",
      "    include:",
      "      - '*'",
      "",
      "variables:",
      "  - name: npm_config_cache",
      "    value: $(Pipeline.Workspace)/.npm",
      "  - name: nodeVersion",
      "    value: 18.x",
      "  - name: testResultsFolder",
      "    value: $(System.DefaultWorkingDirectory)/test-results",
      "  - name: coverageFolder",
      "    value: $(System.DefaultWorkingDirectory)/coverage",
      "",
      "pool:",
      "  vmImage: ubuntu-latest",
      "",
      "stages:",
      "  - stage: Test",
      "    displayName: Testing Stage",
      "    jobs:",
      "      - job: UnitTests",
      "        displayName: Run Unit Tests",
      "        steps:",
      "          - task: NodeTool@0",
      "            displayName: Install Node.js",
      "            inputs:",
      "              versionSpec: $(nodeVersion)",
      "",
      "          - task: Cache@2",
      "            displayName: Cache npm packages",
      "            inputs:",
      "              key: 'npm | \"$(Agent.OS)\" | package-lock.json'",
      "              restoreKeys: |",
      "                npm | \"$(Agent.OS)\"",
      "              path: $(npm_config_cache)",
      "",
      "          - script: npm ci",
      "            displayName: Install dependencies",
      "",
      "          - script: npm run lint",
      "            displayName: Run ESLint",
      "",
      "          - script: npm run type-check",
      "            displayName: TypeScript type checking",
      "",
      "          - script: |",
      "              npm test -- --coverage --watchAll=false",
      "              mv coverage/lcov-report $(coverageFolder)",
      "            displayName: Run unit tests with coverage",
      "",
      "          - task: PublishCodeCoverageResults@2",
      "            displayName: Publish coverage report",
      "            inputs:",
      "              summaryFileLocation: $(coverageFolder)/lcov.info",
      "              pathToSources: $(coverageFolder)",
      "",
      "      - job: IntegrationTests",
      "        displayName: Integration Tests",
      "        dependsOn: UnitTests",
      "        steps:",
      "          - task: Docker@2",
      "            displayName: Start test dependencies",
      "            inputs:",
      "              command: compose",
      "              dockerComposeFile: docker-compose.test.yml",
      "              dockerComposeCommand: up -d",
      "",
      "          - script: npm run test:integration",
      "            displayName: Run integration tests",
      "",
      "          - task: Docker@2",
      "            displayName: Cleanup test dependencies",
      "            condition: always()",
      "            inputs:",
      "              command: compose",
      "              dockerComposeFile: docker-compose.test.yml",
      "              dockerComposeCommand: down",
      "",
      "      - job: E2ETests",
      "        displayName: End-to-End Tests",
      "        dependsOn: IntegrationTests",
      "        steps:",
      "          - task: NodeTool@0",
      "            displayName: Install Node.js",
      "            inputs:",
      "              versionSpec: $(nodeVersion)",
      "",
      "          - script: npm ci",
      "            displayName: Install dependencies",
      "",
      "          - script: npm run build",
      "            displayName: Build application",
      "",
      "          - script: npm run start:test &",
      "            displayName: Start test server",
      "",
      "          - script: npm run test:e2e",
      "            displayName: Run E2E tests",
      "",
      "          - task: PublishTestResults@2",
      "            displayName: Publish test results",
      "            inputs:",
      "              testResultsFormat: JUnit",
      "              testResultsFiles: '**/test-results/e2e/*.xml'",
      "              searchFolder: $(testResultsFolder)",
      "",
      "  - stage: SecurityScan",
      "    displayName: Security Scanning",
      "    dependsOn: Test",
      "    jobs:",
      "      - job: SecurityChecks",
      "        displayName: Security Analysis",
      "        steps:",
      "          - task: NodeTool@0",
      "            displayName: Install Node.js",
      "            inputs:",
      "              versionSpec: $(nodeVersion)",
      "",
      "          - script: npm ci",
      "            displayName: Install dependencies",
      "",
      "          - script: npm audit",
      "            displayName: Run npm audit",
      "",
      "          - script: npx snyk test --all-projects",
      "            displayName: Snyk vulnerability scan",
      "            env:",
      "              SNYK_TOKEN: $(snykToken)",
      "",
      "  - stage: Deploy",
      "    displayName: Deployment Stage",
      "    dependsOn: SecurityScan",
      "    condition: succeeded()",
      "    jobs:",
      "      - deployment: DeployToStaging",
      "        displayName: Deploy to Staging",
      "        environment: staging",
      "        strategy:",
      "          runOnce:",
      "            deploy:",
      "              steps:",
      "                - task: NodeTool@0",
      "                  displayName: Install Node.js",
      "                  inputs:",
      "                    versionSpec: $(nodeVersion)",
      "",
      "                - script: npm ci",
      "                  displayName: Install dependencies",
      "",
      "                - script: npm run build",
      "                  displayName: Build for production",
      "",
      "                - task: AzureWebApp@1",
      "                  displayName: Deploy to Azure Web App",
      "                  inputs:",
      "                    azureSubscription: $(azureServiceConnection)",
      "                    appName: $(webAppNameStaging)",
      "                    package: $(System.DefaultWorkingDirectory)/dist",
      "",
      "                - script: npm run test:smoke -- --baseUrl=$(webAppUrlStaging)",
      "                  displayName: Run smoke tests on staging",
      "",
      "      - deployment: DeployToProduction",
      "        displayName: Deploy to Production",
      "        dependsOn: DeployToStaging",
      "        environment: production",
      "        strategy:",
      "          runOnce:",
      "            deploy:",
      "              steps:",
      "                - task: AzureWebApp@1",
      "                  displayName: Deploy to Production",
      "                  inputs:",
      "                    azureSubscription: $(azureServiceConnection)",
      "                    appName: $(webAppNameProd)",
      "                    package: $(System.DefaultWorkingDirectory)/dist",
      "",
      "                - script: npm run test:smoke -- --baseUrl=$(webAppUrlProd)",
      "                  displayName: Run smoke tests on production"
    ],
    "description": "Comprehensive web application testing pipeline with linting, security scanning, and deployment"
  }
}
